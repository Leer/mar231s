<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>data.table pt3 | Автоматизированный сбор больших данных в экономико-социологических исследованиях</title>
  <meta name="description" content="data.table pt3 | Автоматизированный сбор больших данных в экономико-социологических исследованиях" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="data.table pt3 | Автоматизированный сбор больших данных в экономико-социологических исследованиях" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="data.table pt3 | Автоматизированный сбор больших данных в экономико-социологических исследованиях" />
  
  
  

<meta name="author" content="Ph.A.Upravitelev" />


<meta name="date" content="2023-11-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data.table-pt2.html"/>
<link rel="next" href="dt-etl.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Введение</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#запись-занятия"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#data-culture"><i class="fa fa-check"></i>Data culture</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#обо-мне"><i class="fa fa-check"></i>Обо мне</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#contacts"><i class="fa fa-check"></i>Contacts</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#mm-invite-link"><i class="fa fa-check"></i>MM invite link</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#syllabus"><i class="fa fa-check"></i>Syllabus</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#r-intro"><i class="fa fa-check"></i>R intro</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#short-history"><i class="fa fa-check"></i>Short history</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#r-ecosystem"><i class="fa fa-check"></i>R ecosystem</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#r-rstudio"><i class="fa fa-check"></i>R + RStudio</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#альтернативные-ide"><i class="fa fa-check"></i>Альтернативные IDE</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#style-guide"><i class="fa fa-check"></i>Style guide</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#синтаксис"><i class="fa fa-check"></i>Синтаксис</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#структура-выражения"><i class="fa fa-check"></i>Структура выражения</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#вывод-на-печать"><i class="fa fa-check"></i>Вывод на печать</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#присваивание"><i class="fa fa-check"></i>Присваивание</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#операторы-присвоения"><i class="fa fa-check"></i>Операторы присвоения</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#арифметические-операторы"><i class="fa fa-check"></i>Арифметические операторы</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#операторы-сравнения"><i class="fa fa-check"></i>Операторы сравнения</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#логические-операторы"><i class="fa fa-check"></i>Логические операторы</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#комментарии-и-кавычки"><i class="fa fa-check"></i>Комментарии и кавычки</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#окружение-и-подсказки"><i class="fa fa-check"></i>Окружение и подсказки</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#полезные-функции-для-работы-с-окружением"><i class="fa fa-check"></i>Полезные функции для работы с окружением</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#help"><i class="fa fa-check"></i>help</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#стандартные-ошибки-в-синтаксисе"><i class="fa fa-check"></i>Стандартные ошибки в синтаксисе</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#object-not-found"><i class="fa fa-check"></i>Object not found</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#дополнительные-материалы"><i class="fa fa-check"></i>Дополнительные материалы</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#домашнее-задание"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#организационное-mm"><i class="fa fa-check"></i>Организационное / MM</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#r"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#rstudio"><i class="fa fa-check"></i>RStudio</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#операторы-и-создание-векторов"><i class="fa fa-check"></i>Операторы и создание векторов</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i>Векторы</a>
<ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#запись-занятия-1"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#векторы"><i class="fa fa-check"></i>Векторы</a>
<ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#атомарные-типы-данных"><i class="fa fa-check"></i>Атомарные типы данных</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#создание-векторов"><i class="fa fa-check"></i>Создание векторов</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#приведение-типов"><i class="fa fa-check"></i>Приведение типов</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#выбор-элемента-вектора"><i class="fa fa-check"></i>Выбор элемента вектора</a>
<ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#выбор-по-номеру-позиции"><i class="fa fa-check"></i>Выбор по номеру позиции</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#выбор-по-значению"><i class="fa fa-check"></i>Выбор по значению</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#проверка-на-na"><i class="fa fa-check"></i>Проверка на NA</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#домашнее-задание-1"><i class="fa fa-check"></i>Домашнее задание</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html"><i class="fa fa-check"></i>Списки и таблицы</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#запись-занятия-23-сентября"><i class="fa fa-check"></i>Запись занятия 23 сентября</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#векторы-1"><i class="fa fa-check"></i>Векторы</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#поиск-по-вхождению-в-массив"><i class="fa fa-check"></i>Поиск по вхождению в массив</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#поиск-по-строке"><i class="fa fa-check"></i>Поиск по строке</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#векторизованные-операции"><i class="fa fa-check"></i>Векторизованные операции</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#recycling"><i class="fa fa-check"></i>Recycling</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#изменение-элементов-объектов"><i class="fa fa-check"></i>Изменение элементов объектов</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#списки"><i class="fa fa-check"></i>Списки</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#создание-списков"><i class="fa fa-check"></i>Создание списков</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#именованные-списки"><i class="fa fa-check"></i>Именованные списки</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#выбор-элемента-списка"><i class="fa fa-check"></i>Выбор элемента списка</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#структура-объектов"><i class="fa fa-check"></i>Структура объектов</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#таблицы"><i class="fa fa-check"></i>Таблицы</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#data.frame-vs-data.table-vs-dplyr"><i class="fa fa-check"></i>data.frame vs data.table vs dplyr</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#data.table"><i class="fa fa-check"></i>data.table</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#преимущества-data.table"><i class="fa fa-check"></i>Преимущества data.table</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#установка-и-подключение-пакета"><i class="fa fa-check"></i>Установка и подключение пакета</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#создание-data.table-таблиц"><i class="fa fa-check"></i>Создание data.table-таблиц</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#основная-формула-dt-синтаксиса"><i class="fa fa-check"></i>Основная формула dt-синтаксиса</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#создание-data.table-таблиц-1"><i class="fa fa-check"></i>Создание data.table-таблиц</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#выбор-строки"><i class="fa fa-check"></i>Выбор строки</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#дополнительные-материалы-1"><i class="fa fa-check"></i>Дополнительные материалы</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#домашнее-задание-2"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#векторы-2"><i class="fa fa-check"></i>векторы</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#списки-1"><i class="fa fa-check"></i>списки</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#таблицы.-импорт-данных"><i class="fa fa-check"></i>таблицы. импорт данных</a></li>
<li class="chapter" data-level="" data-path="lists.html"><a href="lists.html#работа-со-строками"><i class="fa fa-check"></i>работа со строками</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html"><i class="fa fa-check"></i>data.table pt1</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#запись-занятия-2"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#разбор-домашней-работы"><i class="fa fa-check"></i>Разбор домашней работы</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#списки-2"><i class="fa fa-check"></i>списки</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#таблицы.-импорт-данных-1"><i class="fa fa-check"></i>таблицы. импорт данных</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#работа-со-строками-1"><i class="fa fa-check"></i>работа со строками</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#основная-формула-dt-синтаксиса-1"><i class="fa fa-check"></i>Основная формула dt-синтаксиса</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#создание-data.table-таблиц-2"><i class="fa fa-check"></i>Создание data.table-таблиц</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#выбор-строки-1"><i class="fa fa-check"></i>Выбор строки</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#работа-с-колонками"><i class="fa fa-check"></i>Работа с колонками</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#обращение-к-колонке"><i class="fa fa-check"></i>Обращение к колонке</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#выбор-нескольких-колонок"><i class="fa fa-check"></i>Выбор нескольких колонок</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#cоздание-колонок"><i class="fa fa-check"></i>Cоздание колонок</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#модификация-колонок"><i class="fa fa-check"></i>Модификация колонок</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#удаление-колонок"><i class="fa fa-check"></i>Удаление колонок</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#вычисления-по-одной-колонке"><i class="fa fa-check"></i>Вычисления по одной колонке</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#группировка-по-нескольким-полям"><i class="fa fa-check"></i>Группировка по нескольким полям</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#sd-advanced"><i class="fa fa-check"></i>.SD (Advanced)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#полезные-ссылки"><i class="fa fa-check"></i>Полезные ссылки</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#домашнее-задание-3"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#работа-с-колонками-1"><i class="fa fa-check"></i>работа с колонками</a></li>
<li class="chapter" data-level="" data-path="data.table-pt1.html"><a href="data.table-pt1.html#для-тех-кто-любит-посложнее"><i class="fa fa-check"></i>для тех, кто любит посложнее</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html"><i class="fa fa-check"></i>data.table pt2</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#запись-занятия-3"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#разбор-домашней-работы-1"><i class="fa fa-check"></i>Разбор домашней работы</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#работа-с-колонками-2"><i class="fa fa-check"></i>работа с колонками</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#для-тех-кто-любит-посложнее-1"><i class="fa fa-check"></i>для тех, кто любит посложнее</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#применение-функций"><i class="fa fa-check"></i>Применение функций</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#dataset"><i class="fa fa-check"></i>dataset</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#применение-функций-1"><i class="fa fa-check"></i>Применение функций</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#количество-строк-и-значений-.n-uniquen"><i class="fa fa-check"></i>Количество строк и значений: .N, uniqueN</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#ветвления-ifelse-fifelse"><i class="fa fa-check"></i>Ветвления: ifelse / fifelse</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#агрегации"><i class="fa fa-check"></i>Агрегации</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#вычисления-по-одной-колонке-1"><i class="fa fa-check"></i>Вычисления по одной колонке</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#вычисления-по-нескольким-колонкам"><i class="fa fa-check"></i>Вычисления по нескольким колонкам</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#группировка-по-нескольким-полям-1"><i class="fa fa-check"></i>Группировка по нескольким полям</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#манипуляции-с-таблицами"><i class="fa fa-check"></i>Манипуляции с таблицами</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#rbind"><i class="fa fa-check"></i>rbind()</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#cbind"><i class="fa fa-check"></i>cbind()</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#домашнее-задание-4"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#level-1-iatytd"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#level-2-hntr"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#level-3-hmp"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#level-4-uv"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt2.html"><a href="data.table-pt2.html#level-5-n"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html"><i class="fa fa-check"></i>data.table pt3</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#запись-занятия-4"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#разбор-домашней-работы-2"><i class="fa fa-check"></i>Разбор домашней работы</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-3-hmp-1"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-4-uv-1"><i class="fa fa-check"></i>level 4 (UV)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#манипуляции-с-таблицами-1"><i class="fa fa-check"></i>Манипуляции с таблицами</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#merge"><i class="fa fa-check"></i>merge()</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#long-wide-форматы-данных"><i class="fa fa-check"></i>long / wide-форматы данных</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#dcast"><i class="fa fa-check"></i>dcast()</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#melt"><i class="fa fa-check"></i>melt()</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#соотношение-list-и-в-операциях-над-колонками."><i class="fa fa-check"></i>Соотношение list() и <code>:=</code> в операциях над колонками.</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#домашнее-задание-5"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-1-iatytd-1"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-2-hntr-1"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-3-hmp-2"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-4-uv-2"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="data.table-pt3.html"><a href="data.table-pt3.html#level-5-n-1"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html"><i class="fa fa-check"></i>dt + ETL</a>
<ul>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#запись-занятия-5"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#разбор-домашней-работы-3"><i class="fa fa-check"></i>Разбор домашней работы</a>
<ul>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-3-hmp-3"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-4-uv-3"><i class="fa fa-check"></i>level 4 (UV)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#etl"><i class="fa fa-check"></i>ETL</a>
<ul>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#чтение-и-запись-текстовых-файлов"><i class="fa fa-check"></i>Чтение и запись текстовых файлов</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#чтение-файлов-ms-excel"><i class="fa fa-check"></i>Чтение файлов MS Excel</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#чтение-файлов-spss"><i class="fa fa-check"></i>Чтение файлов SPSS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#дополнительная-литература"><i class="fa fa-check"></i>Дополнительная литература</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#домашнее-задание-6"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-1-iatytd-2"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-2-hntr-2"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-3-hmp-4"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-4-uv-4"><i class="fa fa-check"></i>level 4 (UV)</a></li>
<li class="chapter" data-level="" data-path="dt-etl.html"><a href="dt-etl.html#level-5-n-2"><i class="fa fa-check"></i>level 5 (N)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i>Dataviz</a>
<ul>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#запись-занятия-6"><i class="fa fa-check"></i>Запись занятия</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#intro-1"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#инфографика"><i class="fa fa-check"></i>Инфографика</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#типы-графиков"><i class="fa fa-check"></i>Типы графиков</a>
<ul>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#scatter-plot"><i class="fa fa-check"></i>scatter plot</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#line-chart"><i class="fa fa-check"></i>line chart</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#bar-chart"><i class="fa fa-check"></i>bar chart</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#grouped-bar-chart"><i class="fa fa-check"></i>grouped bar chart</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#stacked-bar-chart"><i class="fa fa-check"></i>stacked bar chart</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#area-plot"><i class="fa fa-check"></i>area plot</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#area-plot-percentiles"><i class="fa fa-check"></i>area plot (percentiles)</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#boxplot"><i class="fa fa-check"></i>boxplot</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#violin-plot"><i class="fa fa-check"></i>violin plot</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#heatmap"><i class="fa fa-check"></i>heatmap</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#geo-plots-leaflet-map"><i class="fa fa-check"></i>geo plots: leaflet map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#d3-data-driven-documents"><i class="fa fa-check"></i>d3 (Data-Driven Documents)</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#dashboards"><i class="fa fa-check"></i>Dashboards</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#focuses"><i class="fa fa-check"></i>Focuses</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#data-looks-better-naked"><i class="fa fa-check"></i>Data looks better naked</a>
<ul>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#the-data-ink-ratio"><i class="fa fa-check"></i>the data-ink ratio</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#clear-off-the-table"><i class="fa fa-check"></i>clear-off-the-table</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#principles"><i class="fa fa-check"></i>Principles</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#misleading-charts"><i class="fa fa-check"></i>Misleading charts</a>
<ul>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#плохой-дизайн"><i class="fa fa-check"></i>Плохой дизайн</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#арифметические-ошибки"><i class="fa fa-check"></i>Арифметические ошибки</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#манипуляция-вниманием"><i class="fa fa-check"></i>Манипуляция вниманием</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#неверный-масштаб"><i class="fa fa-check"></i>Неверный масштаб</a></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#несоответствие-графиков-цифрам"><i class="fa fa-check"></i>Несоответствие графиков цифрам</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataviz.html"><a href="dataviz.html#полезные-материалы"><i class="fa fa-check"></i>Полезные материалы</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html"><i class="fa fa-check"></i>ggplot2 pt1</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#запись-занятий"><i class="fa fa-check"></i>Запись занятий</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#решение-домашней-работы"><i class="fa fa-check"></i>Решение домашней работы</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#level-1-iatytd-3"><i class="fa fa-check"></i>level 1 (IATYTD)</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#level-2-hntr-3"><i class="fa fa-check"></i>level 2 (HNTR)</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#level-3-hmp-5"><i class="fa fa-check"></i>level 3 (HMP)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#ggplot2-package"><i class="fa fa-check"></i>ggplot2 package</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#компоненты-графика"><i class="fa fa-check"></i>Компоненты графика</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#базовые-геомы"><i class="fa fa-check"></i>Базовые геомы</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#геомы-визуальных-акцентов"><i class="fa fa-check"></i>геомы визуальных акцентов</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#дополнительные-материалы-2"><i class="fa fa-check"></i>Дополнительные материалы</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#домашнее-задание-7"><i class="fa fa-check"></i>Домашнее задание</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#задание-1"><i class="fa fa-check"></i>Задание 1</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#задание-2"><i class="fa fa-check"></i>Задание 2</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#задание-3"><i class="fa fa-check"></i>Задание 3</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#задание-4"><i class="fa fa-check"></i>Задание 4</a></li>
<li class="chapter" data-level="" data-path="ggplot2-pt1.html"><a href="ggplot2-pt1.html#задание-5"><i class="fa fa-check"></i>Задание 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html"><i class="fa fa-check"></i>HW 1</a>
<ul>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#общие-замечания"><i class="fa fa-check"></i>Общие замечания</a></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#задание-1.-дома-в-игре-престолов."><i class="fa fa-check"></i>Задание 1. Дома в Игре престолов.</a>
<ul>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#импорт-данных"><i class="fa fa-check"></i>импорт данных</a></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#чистка-данных"><i class="fa fa-check"></i>чистка данных</a></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#график-численности-кланов"><i class="fa fa-check"></i>график численности кланов</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#задание-2.-агрессивность-персонажей-в-книгах-о-гарри-поттере."><i class="fa fa-check"></i>Задание 2. Агрессивность персонажей в книгах о Гарри Поттере.</a></li>
<li class="chapter" data-level="" data-path="hw-1.html"><a href="hw-1.html#задание-3.-динамика-среднегодовой-температуры-в-период-1750-2015"><i class="fa fa-check"></i>Задание 3. Динамика среднегодовой температуры в период 1750-2015</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Автоматизированный сбор больших данных в экономико-социологических исследованиях</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data.table-pt3" class="section level1 unnumbered hasAnchor">
<h1>data.table pt3<a href="data.table-pt3.html#data.table-pt3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="запись-занятия-4" class="section level2 unnumbered hasAnchor">
<h2>Запись занятия<a href="data.table-pt3.html#запись-занятия-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Запись занятия 14 октября:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/GFUtbhB1tgE?si=HsYCs_sIdgM_ZyEv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
</iframe>
</div>
<div id="разбор-домашней-работы-2" class="section level2 unnumbered hasAnchor">
<h2>Разбор домашней работы<a href="data.table-pt3.html#разбор-домашней-работы-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="level-3-hmp-1" class="section level3 unnumbered hasAnchor">
<h3>level 3 (HMP)<a href="data.table-pt3.html#level-3-hmp-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>изучите справку по функции <code>ifelse()</code> (или <code>fifelse()</code> в data.table)</p></li>
<li><p>создайте копию колонки <code>gender</code>, назовите ее <code>gender_2</code>. Замените в ней все <code>n/a</code> и <code>hermaphrodite</code> на <code>other</code>. Посчитайте количество персонажей в зависимости от пола (<code>gender_2</code>):</p></li>
</ul>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="data.table-pt3.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb255-2"><a href="data.table-pt3.html#cb255-2" aria-hidden="true" tabindex="-1"></a>sw <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&#39;http://bit.ly/39aOUne&#39;</span>)</span>
<span id="cb255-3"><a href="data.table-pt3.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="data.table-pt3.html#cb255-4" aria-hidden="true" tabindex="-1"></a>sw[, gender_2 <span class="sc">:</span><span class="er">=</span> gender]</span>
<span id="cb255-5"><a href="data.table-pt3.html#cb255-5" aria-hidden="true" tabindex="-1"></a>sw[gender_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;n/a&#39;</span>, <span class="st">&#39;hermaphrodite&#39;</span>), gender_2 <span class="sc">:</span><span class="er">=</span> <span class="st">&#39;other&#39;</span>]</span>
<span id="cb255-6"><a href="data.table-pt3.html#cb255-6" aria-hidden="true" tabindex="-1"></a>sw[, .N, by <span class="ot">=</span> gender_2]</span></code></pre></div>
<pre><code>##    gender_2  N
## 1:     male 57
## 2:    other  4
## 3:   female 16</code></pre>
<ul>
<li>выполните предыдущее задание без создания промежуточной колонки <code>gender_2</code></li>
</ul>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="data.table-pt3.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># два альтернативных решения</span></span>
<span id="cb257-2"><a href="data.table-pt3.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sw[gender %in% c(&#39;n/a&#39;, &#39;hermaphrodite&#39;), gender := &#39;other&#39;]</span></span>
<span id="cb257-3"><a href="data.table-pt3.html#cb257-3" aria-hidden="true" tabindex="-1"></a>sw[, gender <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(gender <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;n/a&#39;</span>, <span class="st">&#39;hermaphrodite&#39;</span>), <span class="st">&#39;other&#39;</span>, gender)]</span>
<span id="cb257-4"><a href="data.table-pt3.html#cb257-4" aria-hidden="true" tabindex="-1"></a>sw[, .N, by <span class="ot">=</span> gender]</span></code></pre></div>
<pre><code>##    gender  N
## 1:   male 57
## 2:  other  4
## 3: female 16</code></pre>
</div>
<div id="level-4-uv-1" class="section level3 unnumbered hasAnchor">
<h3>level 4 (UV)<a href="data.table-pt3.html#level-4-uv-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>сделайте сводную таблицу <code>planet_chars</code> по персонажам каждой планеты, где в колонках будет количество персонажей, их средний рост и вес (оригинальный и скорректированный).</p></li>
<li><p>округлите значения до 1 знака после запятой</p></li>
</ul>
<p>Первые 5 строк результата:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="data.table-pt3.html#cb259-1" aria-hidden="true" tabindex="-1"></a>sw[, mass_corrected <span class="sc">:</span><span class="er">=</span> mass]</span>
<span id="cb259-2"><a href="data.table-pt3.html#cb259-2" aria-hidden="true" tabindex="-1"></a>sw[, mass_mean <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), by <span class="ot">=</span> <span class="fu">list</span>(planet_name, gender)]</span>
<span id="cb259-3"><a href="data.table-pt3.html#cb259-3" aria-hidden="true" tabindex="-1"></a>sw[<span class="fu">is.na</span>(mass), mass_corrected <span class="sc">:</span><span class="er">=</span> mass_mean]</span>
<span id="cb259-4"><a href="data.table-pt3.html#cb259-4" aria-hidden="true" tabindex="-1"></a>planet_chars <span class="ot">&lt;-</span> sw[, <span class="fu">list</span>(</span>
<span id="cb259-5"><a href="data.table-pt3.html#cb259-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_chars =</span> .N,</span>
<span id="cb259-6"><a href="data.table-pt3.html#cb259-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">height_mn =</span> <span class="fu">round</span>(<span class="fu">mean</span>(height), <span class="dv">1</span>),</span>
<span id="cb259-7"><a href="data.table-pt3.html#cb259-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">mass_mn =</span> <span class="fu">round</span>(<span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>),</span>
<span id="cb259-8"><a href="data.table-pt3.html#cb259-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mass_corrected_mn =</span> <span class="fu">round</span>(<span class="fu">mean</span>(mass_corrected, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>)</span>
<span id="cb259-9"><a href="data.table-pt3.html#cb259-9" aria-hidden="true" tabindex="-1"></a>), by <span class="ot">=</span> planet_name]</span>
<span id="cb259-10"><a href="data.table-pt3.html#cb259-10" aria-hidden="true" tabindex="-1"></a>planet_chars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##    planet_name n_chars height_mn mass_mn mass_corrected_mn
## 1:    Tatooine      10     169.8    85.4              85.8
## 2:      Kamino       3     208.3    83.1              83.1
## 3:    Geonosis       1     183.0    80.0              80.0
## 4:      Utapau       1     206.0    80.0              80.0
## 5:    Kashyyyk       2     231.0   124.0             124.0</code></pre>
</div>
</div>
<div id="манипуляции-с-таблицами-1" class="section level2 hasAnchor">
<h2>Манипуляции с таблицами<a href="data.table-pt3.html#манипуляции-с-таблицами-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="merge" class="section level3 unnumbered hasAnchor">
<h3>merge()<a href="data.table-pt3.html#merge" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Одна из самых, наверное, важных операций при работе с таблицами - построчное слияние двух или нескольких таблиц. При использовании функции <code>merge()</code> каждому значению в ключевой колонке первой таблицы сопоставляется строка параметров наблюдения другой таблицы, с таким же значением в ключевой колонке, как и в первой таблице. В других языках программирования, в SQL, в частности, аналогичная функция может называться <code>join</code>.
Несмотря на сложность формулировки, выглядит это достаточно просто:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="data.table-pt3.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем датасет 1, в синтасисе data.table</span></span>
<span id="cb261-2"><a href="data.table-pt3.html#cb261-2" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">key_col =</span> <span class="fu">c</span>(<span class="st">&#39;r1&#39;</span>, <span class="st">&#39;r2&#39;</span>, <span class="st">&#39;r3&#39;</span>),</span>
<span id="cb261-3"><a href="data.table-pt3.html#cb261-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_num =</span> <span class="fu">seq_len</span>(<span class="dv">3</span>))</span>
<span id="cb261-4"><a href="data.table-pt3.html#cb261-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-5"><a href="data.table-pt3.html#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем датасет 2, в синтасисе data.table</span></span>
<span id="cb261-6"><a href="data.table-pt3.html#cb261-6" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">key_col =</span> <span class="fu">c</span>(<span class="st">&#39;r3&#39;</span>, <span class="st">&#39;r1&#39;</span>, <span class="st">&#39;r2&#39;</span>),</span>
<span id="cb261-7"><a href="data.table-pt3.html#cb261-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_char =</span> <span class="fu">c</span>(<span class="st">&#39;c&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>))</span>
<span id="cb261-8"><a href="data.table-pt3.html#cb261-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-9"><a href="data.table-pt3.html#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="co"># сливаем построчно по значениям в колонке key_col</span></span>
<span id="cb261-10"><a href="data.table-pt3.html#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<p>Здесь первая таблица задается аргументом <code>x</code>, вторая таблица - аргументом <code>y</code>, а колонка (или колонки), по значениям которой происходит слияние таблиц, задается аргументом <code>by</code>. Если аргумент <code>by</code> не указан, то слияние происходит по тем колонкам, которые имеют одинаковое название в сливаемых таблицах. Притом, таблицы можно сливать по значениям колонок разными именами, тогда надо отдельно указать, по значениям каких колонок в первой и второй таблице происходит слияние, и для этого вместо общего аргумента <code>by</code> используют аргументы <code>by.x</code> и <code>by.y</code> для первой и второй таблицы соответственно.</p>
<p>В первом приближении операция слияния <code>merge()</code> похожа на результат работы функции <code>cbind()</code>. Однако, из-за того, что при слиянии происходит сопоставление по значениям ключевых колонок, в результате получается решается проблема слияния колонок, в которых разный порядок строк. Сравните:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="data.table-pt3.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(dt1, dt2)</span></code></pre></div>
<pre><code>##    key_col col_num key_col col_char
## 1:      r1       1      r3        c
## 2:      r2       2      r1        a
## 3:      r3       3      r2        b</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="data.table-pt3.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<p>Второе существенное отличие от <code>cbind()</code> - обработка ситуаций, когда в таблицах разное количество наблюдений. Например, в первой таблице данные по первой волне опросов, а во второй - данные по тем, кто из принявших участие в первой волне, принял участие и во второй волне, а так же какие-то новые опрошенные респонденты. Разное количество наблюдений в сливаемых таблицах порождает четыре варианта слияния, все они задаются аргументом <code>all</code> с постфикасми.</p>
<p>Варианты направлений слияния (мерджа) таблиц:</p>
<ul>
<li><code>all</code> = FALSE. Значение аргумента по умолчанию, в результате слияния будет таблица с наблюдениями, которые есть и в первой, и во второй таблице. То есть, наблюдения из первой таблицы, которым нет сопоставления из второй таблицы, отбрасываются. В примере с волнами это будет таблица только по тем, кто принял участи и в первой, и во второй волнах опросов:</li>
</ul>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="data.table-pt3.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># сливаем так, чтобы оставить только тех, кто был в обеих таблицах, это значение по умолчанию</span></span>
<span id="cb267-2"><a href="data.table-pt3.html#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>, <span class="at">all =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<ul>
<li><code>all.x</code> = TRUE. Всем наблюдениям из первой таблицы сопоставляются значения из второй. Если во второй таблице нет соответствующих наблюдений, то пропуски заполняются <code>NA</code>-значениями (в нашем примере в колонке <code>col2</code>):</li>
</ul>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="data.table-pt3.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<ul>
<li><code>all.y</code> = TRUE. Обратная ситуация, когда всем наблюдениям из второй таблицы сопоставляются значения из первой, и пропущенные значения заполняются <code>NA</code>-значениями (в нашем примере в колонке <code>co12</code>):</li>
</ul>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="data.table-pt3.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<ul>
<li><code>all</code> = TRUE. Объединение предыдущих двух вариантов - создается таблица по всему набору уникальных значений из ключевых таблиц, по которым происходит слияние. и если в какой-то из таблиц нет соответствующих наблюдений, то пропуски также заполняются <code>NA</code>-значениями:</li>
</ul>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="data.table-pt3.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> dt1, <span class="at">y =</span> dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r2       2        b
## 3:      r3       3        c</code></pre>
<p>При работе с несколькими таблицами можно столкнуться с ограничением, что базовая функциz <code>merge()</code> работает только с парами таблиц. То есть, если вдруг необходимо слить по одному ключу сразу несколько таблиц (например, не две волны опросов, а пять), то придется строить последовательные цепочки попарных слияний.</p>
<p><strong>Alarm!</strong>
Необходимо помнить, что в ситуациях, когда одному значению ключа в первой таблице соответствует одна строка, а во второй таблице - несколько строк, то в результате слияния таблиц значения из первой таблицы размножатся по количеству строк во второй таблице:</p>
<p>Создаем данные:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="data.table-pt3.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем датасет 1, в синтасисе data.table</span></span>
<span id="cb275-2"><a href="data.table-pt3.html#cb275-2" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">key_col =</span> <span class="fu">c</span>(<span class="st">&#39;r1&#39;</span>, <span class="st">&#39;r2&#39;</span>, <span class="st">&#39;r3&#39;</span>, <span class="st">&#39;r4&#39;</span>, <span class="st">&#39;r1&#39;</span>),</span>
<span id="cb275-3"><a href="data.table-pt3.html#cb275-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_num =</span> <span class="fu">seq_len</span>(<span class="dv">5</span>))</span>
<span id="cb275-4"><a href="data.table-pt3.html#cb275-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-5"><a href="data.table-pt3.html#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем датасет 2, в синтасисе data.table</span></span>
<span id="cb275-6"><a href="data.table-pt3.html#cb275-6" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">key_col =</span> <span class="fu">c</span>(<span class="st">&#39;r3&#39;</span>, <span class="st">&#39;r1&#39;</span>, <span class="st">&#39;r2&#39;</span>, <span class="st">&#39;r5&#39;</span>, <span class="st">&#39;r1&#39;</span>, <span class="st">&#39;r1&#39;</span>),</span>
<span id="cb275-7"><a href="data.table-pt3.html#cb275-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_char =</span> <span class="fu">c</span>(<span class="st">&#39;c&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;f&#39;</span>))</span></code></pre></div>
<p>Тут мы видим, что в первой таблице есть две строки с <code>key_col = r1</code>, а во второй таблице – три строки.</p>
<p>Сливаем и получаем размножение значений из первой таблицы для ключа <code>key_col = r1</code>, значения <code>1</code> и <code>5</code> из колонки <code>col1</code> теперь встречается три раза. А значения <code>a</code>, <code>e</code> и <code>f</code> встречаются по два раза:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="data.table-pt3.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(dt1, dt2, <span class="at">by =</span> <span class="st">&#39;key_col&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    key_col col_num col_char
## 1:      r1       1        a
## 2:      r1       1        e
## 3:      r1       1        f
## 4:      r1       5        a
## 5:      r1       5        e
## 6:      r1       5        f
## 7:      r2       2        b
## 8:      r3       3        c
## 9:      r4       4     &lt;NA&gt;</code></pre>
<p>То есть три значения из второй таблицы повторились для каждого значения из первой таблицы. В результате у нас получилось шесть строк.</p>
</div>
<div id="long-wide-форматы-данных" class="section level3 unnumbered hasAnchor">
<h3>long / wide-форматы данных<a href="data.table-pt3.html#long-wide-форматы-данных" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Обычная форма представления данных в таблицах — когда одна строка является одним наблюдением, а в значениях колонок отражены те или иные характеристики этого наблюдения. Такой формат традиционно называется <code>wide</code>-форматом, потому что при увеличении количества характеристик таблица будет расти вширь, путем увеличения числа колонок. Пример таблицы в <code>wide</code>-формате.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="data.table-pt3.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем таблицу с идентификатором респондента, его возрастом, ростом и весом</span></span>
<span id="cb278-2"><a href="data.table-pt3.html#cb278-2" aria-hidden="true" tabindex="-1"></a>dt_wide <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb278-3"><a href="data.table-pt3.html#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> <span class="fu">paste0</span>(<span class="st">&#39;wave_&#39;</span>, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">2</span>)),</span>
<span id="cb278-4"><a href="data.table-pt3.html#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">paste0</span>(<span class="st">&#39;id_&#39;</span>, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb278-5"><a href="data.table-pt3.html#cb278-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">68</span>, <span class="dv">47</span>, <span class="dv">69</span>),</span>
<span id="cb278-6"><a href="data.table-pt3.html#cb278-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">163</span>, <span class="dv">142</span>, <span class="dv">164</span>, <span class="dv">140</span>),</span>
<span id="cb278-7"><a href="data.table-pt3.html#cb278-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">47</span>))</span>
<span id="cb278-8"><a href="data.table-pt3.html#cb278-8" aria-hidden="true" tabindex="-1"></a>dt_wide</span></code></pre></div>
<pre><code>##      wave   id age height weight
## 1: wave_1 id_1  45    163     55
## 2: wave_1 id_2  68    142     40
## 3: wave_2 id_1  47    164     50
## 4: wave_2 id_2  69    140     47</code></pre>
<p>Тем не менее, нередко встречается другой формат, в котором на одно наблюдение может приходиться несколько строк (по количеству измеренных характеристик этого наблюдения). В таком случае таблица состоит из колонки, в которой содержится какой-то идентификатор объекта, одной или нескольких колонок, в которых содержатся идентификаторы характеристик объекта, и колонки, в которой содержатся значения этих характеристик. Такой формат называется длинным, <code>long</code>-форматом данных, потому что при увеличении количества измеряемых характеристик таблица будет расти в длину увеличением строк.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="data.table-pt3.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем таблицу с идентификатором респондента, его возрастом, ростом и весом</span></span>
<span id="cb280-2"><a href="data.table-pt3.html#cb280-2" aria-hidden="true" tabindex="-1"></a>dt_long <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb280-3"><a href="data.table-pt3.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># две волны, по два респондента в каждой</span></span>
<span id="cb280-4"><a href="data.table-pt3.html#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> <span class="fu">paste0</span>(<span class="st">&#39;wave_&#39;</span>, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">6</span>)),</span>
<span id="cb280-5"><a href="data.table-pt3.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># на каждого респондента задаем три строки</span></span>
<span id="cb280-6"><a href="data.table-pt3.html#cb280-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">paste0</span>(<span class="st">&#39;id_&#39;</span>, <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">3</span>), <span class="dv">2</span>)),</span>
<span id="cb280-7"><a href="data.table-pt3.html#cb280-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># три характеристики повторяем для четырех респондентов</span></span>
<span id="cb280-8"><a href="data.table-pt3.html#cb280-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;height&#39;</span>, <span class="st">&#39;weight&#39;</span>), <span class="dv">4</span>),</span>
<span id="cb280-9"><a href="data.table-pt3.html#cb280-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># задаем значения характеристик, с учетом того, как упорядочены первые две колонки</span></span>
<span id="cb280-10"><a href="data.table-pt3.html#cb280-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">163</span>, <span class="dv">55</span>,</span>
<span id="cb280-11"><a href="data.table-pt3.html#cb280-11" aria-hidden="true" tabindex="-1"></a>            <span class="dv">68</span>, <span class="dv">142</span>, <span class="dv">40</span>,</span>
<span id="cb280-12"><a href="data.table-pt3.html#cb280-12" aria-hidden="true" tabindex="-1"></a>            <span class="dv">47</span>, <span class="dv">164</span>, <span class="dv">50</span>,</span>
<span id="cb280-13"><a href="data.table-pt3.html#cb280-13" aria-hidden="true" tabindex="-1"></a>            <span class="dv">69</span>, <span class="dv">140</span>, <span class="dv">47</span>))</span>
<span id="cb280-14"><a href="data.table-pt3.html#cb280-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-15"><a href="data.table-pt3.html#cb280-15" aria-hidden="true" tabindex="-1"></a>dt_long</span></code></pre></div>
<pre><code>##       wave   id variable value
##  1: wave_1 id_1      age    45
##  2: wave_1 id_1   height   163
##  3: wave_1 id_1   weight    55
##  4: wave_1 id_2      age    68
##  5: wave_1 id_2   height   142
##  6: wave_1 id_2   weight    40
##  7: wave_2 id_1      age    47
##  8: wave_2 id_1   height   164
##  9: wave_2 id_1   weight    50
## 10: wave_2 id_2      age    69
## 11: wave_2 id_2   height   140
## 12: wave_2 id_2   weight    47</code></pre>
<p><br></p>
</div>
<div id="dcast" class="section level3 unnumbered hasAnchor">
<h3>dcast()<a href="data.table-pt3.html#dcast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Для того, чтобы трансформировать <code>long</code>-формат в <code>wide</code>-формат, используется функция <code>dcast()</code> пакета <code>data.table</code> (либо <code>cast()</code> пакета <code>reshape2</code>). Также можно использовать функцию <code>reshape()</code> из базового набора функций R, однако эта функция достаточно медленная по скорости работы.</p>
<p>Для того, чтобы превратить созданную выше таблицу в <code>long</code>-формате в широкий формат, выражение будет выглядеть следующим образом (сама операция называется решейп):</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="data.table-pt3.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="at">data =</span> dt_long, <span class="at">formula =</span> wave <span class="sc">+</span> id <span class="sc">~</span> variable, <span class="at">value.var =</span> <span class="st">&#39;value&#39;</span>)</span></code></pre></div>
<pre><code>##      wave   id age height weight
## 1: wave_1 id_1  45    163     55
## 2: wave_1 id_2  68    142     40
## 3: wave_2 id_1  47    164     50
## 4: wave_2 id_2  69    140     47</code></pre>
<p>Здесь аргумент <code>data</code> - определяет таблицу, которую мы хотим трансформировать.</p>
<p>Аргумент <code>formula</code> задает, что в результирующей таблице будет задавать уникальное наблюдение, и значения какой колонки будут разделены на самостоятельные колонки. Формулу можно прочитать как <code>строки ~ колонки</code> в результирующей таблице. В нашем случае уникальное наблюдение мы задаем парой переменных <code>wave</code> и <code>id</code>, поэтому мы их указываем до тильды через <code>+</code>. Колонки же мы создаем по значениям переменной <code>variable</code>, после тильды. Следует отметить, что ситуация, когда строка задается несколькими переменными через оператор <code>+</code>, весьма частая, а вот в правой части формулы несколько переменных встречаются достаточно редко, обычно все же на колонки раскладывают по значениям одной переменной.</p>
<p>Аргумент <code>value.var</code> содержит текстовое название переменной, значения которой будут отражены в результирующей таблице по колонкам для каждого наблюдения.</p>
<p>Иногда случаются ситуации, когда необходимо провести сначала агрегацию по одной из колонок, описывающих наблюдение. Например, вычислить средние значения возраста, роста и веса для каждой волны. Это можно сделать в два этапа - сначала провести агрегацию, и потом решейп. Также можно сразу сделать решейп, и воспользоваться дополнительным аргументом <code>fun.aggregate</code>, который сразу, при решейпе, агрегирует данные. Например, если использовать сначала агрегацию, а потом трансформацию в <code>wide</code>-формат:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="data.table-pt3.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># агрегируем наблюдения по волнам и характеристикам</span></span>
<span id="cb284-2"><a href="data.table-pt3.html#cb284-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> dt_long[, <span class="fu">list</span>(<span class="at">value =</span> <span class="fu">mean</span>(value)), by <span class="ot">=</span> <span class="fu">list</span>(wave, variable)]</span>
<span id="cb284-3"><a href="data.table-pt3.html#cb284-3" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre><code>##      wave variable value
## 1: wave_1      age  56.5
## 2: wave_1   height 152.5
## 3: wave_1   weight  47.5
## 4: wave_2      age  58.0
## 5: wave_2   height 152.0
## 6: wave_2   weight  48.5</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="data.table-pt3.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># трансформируем в wide-формат. колонки id уже нет в таблице, поэтому удаляем из формулы</span></span>
<span id="cb286-2"><a href="data.table-pt3.html#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="at">data =</span> tmp, <span class="at">formula =</span> wave <span class="sc">~</span> variable, <span class="at">value.var =</span> <span class="st">&#39;value&#39;</span>)</span></code></pre></div>
<pre><code>##      wave  age height weight
## 1: wave_1 56.5  152.5   47.5
## 2: wave_2 58.0  152.0   48.5</code></pre>
<p>Аналогично, но с использованием аргумента <code>fun.aggregate</code>. В значения аргумента передаём название функции без кавычек и скобок, в нашем случае это <code>fun.aggregate = mean</code>:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="data.table-pt3.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="at">data =</span> tmp, <span class="at">formula =</span> wave <span class="sc">~</span> variable, <span class="at">value.var =</span> <span class="st">&#39;value&#39;</span>, <span class="at">fun.aggregate =</span> mean)</span></code></pre></div>
<pre><code>##      wave  age height weight
## 1: wave_1 56.5  152.5   47.5
## 2: wave_2 58.0  152.0   48.5</code></pre>
<p><br></p>
</div>
<div id="melt" class="section level3 unnumbered hasAnchor">
<h3>melt()<a href="data.table-pt3.html#melt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Обратная трансформация также возможна, из <code>wide</code>-формата в <code>long</code>-формат. Для этого используется функция <code>melt()</code>:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="data.table-pt3.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(<span class="at">data =</span> dt_wide, </span>
<span id="cb290-2"><a href="data.table-pt3.html#cb290-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&#39;wave&#39;</span>, <span class="st">&#39;id&#39;</span>),</span>
<span id="cb290-3"><a href="data.table-pt3.html#cb290-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;height&#39;</span>, <span class="st">&#39;weight&#39;</span>),</span>
<span id="cb290-4"><a href="data.table-pt3.html#cb290-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">variable.name =</span> <span class="st">&#39;variable&#39;</span>,</span>
<span id="cb290-5"><a href="data.table-pt3.html#cb290-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">value.name =</span> <span class="st">&#39;value&#39;</span>)</span></code></pre></div>
<pre><code>##       wave   id variable value
##  1: wave_1 id_1      age    45
##  2: wave_1 id_2      age    68
##  3: wave_2 id_1      age    47
##  4: wave_2 id_2      age    69
##  5: wave_1 id_1   height   163
##  6: wave_1 id_2   height   142
##  7: wave_2 id_1   height   164
##  8: wave_2 id_2   height   140
##  9: wave_1 id_1   weight    55
## 10: wave_1 id_2   weight    40
## 11: wave_2 id_1   weight    50
## 12: wave_2 id_2   weight    47</code></pre>
<p>Здесь аргумент <code>id.vars</code> задает переменные, которые будут использоваться для уникальной идентификации наблюдения. Аргумент <code>measure.vars</code> определяет те колонки, которые войдут длинную таблицу как значения переменной характеристик наблюдений (когда каждая строка — отдельная характеристика наблюдения, несколько строк на одного пользователя). Аргументы <code>variable.name</code> и <code>value.name</code> задают, соответственно, названия колонок характеристик наблюдения и значений этих характеристик в финальной таблице.</p>
</div>
</div>
<div id="соотношение-list-и-в-операциях-над-колонками." class="section level2 hasAnchor">
<h2>Соотношение list() и <code>:=</code> в операциях над колонками.<a href="data.table-pt3.html#соотношение-list-и-в-операциях-над-колонками." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>На занятии я заметил, что многие путаются в синтаксисе создания новых колонок и в выражении <code>list()</code>. Различие следующее:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="data.table-pt3.html#cb292-1" aria-hidden="true" tabindex="-1"></a>sw[, new_value <span class="sc">:</span><span class="er">=</span> <span class="st">&#39;bla-bla-bla&#39;</span>]</span>
<span id="cb292-2"><a href="data.table-pt3.html#cb292-2" aria-hidden="true" tabindex="-1"></a>sw[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##                  name height mass skin_color gender planet_name gender_2
## 1:     Luke Skywalker    172   77       fair   male    Tatooine     male
## 2:              C-3PO    167   75       gold  other    Tatooine    other
## 3:        Darth Vader    202  136      white   male    Tatooine     male
## 4:          Owen Lars    178  120      light   male    Tatooine     male
## 5: Beru Whitesun lars    165   75      light female    Tatooine   female
##    mass_corrected mass_mean   new_value
## 1:             77     100.2 bla-bla-bla
## 2:             75      53.5 bla-bla-bla
## 3:            136     100.2 bla-bla-bla
## 4:            120     100.2 bla-bla-bla
## 5:             75      75.0 bla-bla-bla</code></pre>
<p>Здесь выражение <code>sw[, new_value := 'bla-bla-bla']</code> можно прочитать как <code>в таблице sw создай новую колонку new_value и запиши в нее значение 'bla-bla-bla'</code>. Одинарное значение будет размножено по количеству строк. Вместо <code>'bla-bla-bla'</code> также может быть и какая-нибудь функция, которая создает вектор такой же длины, сколько строк в таблице (если больше или меньше, то выдаст ошибку):</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="data.table-pt3.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в таблице 77 строк, поэтому можем просто указать 77:1</span></span>
<span id="cb294-2"><a href="data.table-pt3.html#cb294-2" aria-hidden="true" tabindex="-1"></a>sw[, new_value2 <span class="sc">:</span><span class="er">=</span> <span class="dv">77</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb294-3"><a href="data.table-pt3.html#cb294-3" aria-hidden="true" tabindex="-1"></a>sw[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##                  name height mass skin_color gender planet_name gender_2
## 1:     Luke Skywalker    172   77       fair   male    Tatooine     male
## 2:              C-3PO    167   75       gold  other    Tatooine    other
## 3:        Darth Vader    202  136      white   male    Tatooine     male
## 4:          Owen Lars    178  120      light   male    Tatooine     male
## 5: Beru Whitesun lars    165   75      light female    Tatooine   female
##    mass_corrected mass_mean   new_value new_value2
## 1:             77     100.2 bla-bla-bla         77
## 2:             75      53.5 bla-bla-bla         76
## 3:            136     100.2 bla-bla-bla         75
## 4:            120     100.2 bla-bla-bla         74
## 5:             75      75.0 bla-bla-bla         73</code></pre>
<p>Выражение <em>sw[, new_value2 := 77:1]</em> можно прочитать как <strong>в таблице sw создай новую колонку new_value2 и запиши в нее вектор, который получится в результате выполнения выражения 77:1</strong>.</p>
<p>Конструкция с <code>list()</code> используется тогда, когда на основе существующей таблицы надо создать новую таблицу. Фактически это создание нового списка на основе колонок таблицы, просто в результате будет таблица и класс data.table:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="data.table-pt3.html#cb296-1" aria-hidden="true" tabindex="-1"></a>new_dt <span class="ot">&lt;-</span> sw[, <span class="fu">list</span>(<span class="at">total_users =</span> <span class="fu">uniqueN</span>(name), </span>
<span id="cb296-2"><a href="data.table-pt3.html#cb296-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">height_mn =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb296-3"><a href="data.table-pt3.html#cb296-3" aria-hidden="true" tabindex="-1"></a>new_dt</span></code></pre></div>
<pre><code>##    total_users height_mn
## 1:          77  176.2078</code></pre>
<p>Здесь выражение <strong>new_dt &lt;- sw[, list(total_users = uniqueN(name), height_mn = mean(height, na.rm = TRUE))]</strong> можно прочитать следующим образом: <strong>на основе таблицы sw создай таблицу, в которой в колонку total_users запиши количество уникальных значений из колонки name, а в height_mn - среднее значение по колонке height Полученную таблицу запиши в объект new_dt</strong>.
Надо помнить, что <code>total_users</code> и <code>height_mn</code> - это колонки, которые будут в новой таблице, в <code>sw</code> их нет.</p>
<p>Соответственно, использовать <code>:=</code> вместе с <code>list()</code> некорректно. Точно также использовать знак <code>=</code> неправильно для создания новых колонок в уже существующей таблице, интерпретатор вернет ошибку.</p>
<p><br></p>
</div>
<div id="домашнее-задание-5" class="section level2 unnumbered hasAnchor">
<h2>Домашнее задание<a href="data.table-pt3.html#домашнее-задание-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="level-1-iatytd-1" class="section level3 unnumbered hasAnchor">
<h3>level 1 (IATYTD)<a href="data.table-pt3.html#level-1-iatytd-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Посчитайте, сколько пользователей (<code>user_pseudo_id</code>) в приложение, с разбивкой по платформам (<code>platform</code>).
Датасет: <a href="https://gitlab.com/hse_mar/mar211f/-/raw/main/data/installs.csv" class="uri">https://gitlab.com/hse_mar/mar211f/-/raw/main/data/installs.csv</a></p>
<pre><code>##    platform n_users
## 1:  ANDROID   86112
## 2:      IOS   39484</code></pre>
<p>Проверьте, нет ли дублей в таблице (когда несколько записей на одного пользователя).
Подумайте, как можно от них избавиться.</p>
</div>
<div id="level-2-hntr-1" class="section level3 unnumbered hasAnchor">
<h3>level 2 (HNTR)<a href="data.table-pt3.html#level-2-hntr-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Посчитайте, сколько было платящих пользователей (<code>n_payers</code>), сколько они сделали платежей (<code>n_purchases</code>) и на какую сумму (<code>gross</code>), сколько в среднем сделал платежей каждый пользователь (<code>purchases_per_user</code>), средний размер платежа (<code>purchase_mn</code>) и сколько в среднем заплатил каждый пользователь (<code>ARPPU</code>).
Датасет: <a href="https://gitlab.com/hse_mar/mar211f/-/raw/main/data/payments_custom.csv" class="uri">https://gitlab.com/hse_mar/mar211f/-/raw/main/data/payments_custom.csv</a></p>
<pre><code>##    n_payers    gross n_purchases purchases_per_user purchase_mn  ARPPU
## 1:     7228 291734.2       35585               4.92         8.2 40.362</code></pre>
</div>
<div id="level-3-hmp-2" class="section level3 unnumbered hasAnchor">
<h3>level 3 (HMP)<a href="data.table-pt3.html#level-3-hmp-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Сделайте предыдущее задание, только добавьте разбивку по платформам.
Добавьте <code>total</code> (то есть статистику по всей выборке, без разбивки).</p>
<pre><code>##    platform n_payers  gross n_purchases purchases_per_user purchase_mn  ARPPU
## 1:  ANDROID     3420  95069       12752               3.73        7.46 27.798
## 2:      IOS     3808 196665       22833               6.00        8.61 51.645
## 3:      All     7228 291734       35585               4.92        8.20 40.362</code></pre>
</div>
<div id="level-4-uv-2" class="section level3 unnumbered hasAnchor">
<h3>level 4 (UV)<a href="data.table-pt3.html#level-4-uv-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Сделайте предыдущее задание, только добавьте разбивку по полю <code>media_source</code> из таблицы инсталлов (для сопоставления нужен <code>user_pseudo_id</code>). Имейте в виду, в <code>payments</code> все платежи, а нам нужны только по тем пользователям, кто установил приложение (т.е. есть в таблице <code>installs</code>)</p>
<p>Пропущенные значения и <code>other</code> в поле <code>media_source</code> перекодируйте в <code>organic</code>.
Аналогично, добавьте <code>total</code>.</p>
<pre><code>##         media_source n_payers  gross n_purchases purchases_per_user purchase_mn
## 1:           organic     1329  60673        6742               5.07        9.00
## 2:      unityads_int      273   7783        1176               4.31        6.62
## 3:      applovin_int     1190  51544        6203               5.21        8.31
## 4:      Facebook Ads       54   1051         118               2.19        8.91
## 5: googleadwords_int      169   5367         643               3.80        8.35
## 6:               All     3015 126418       14882               4.94        8.49
##     ARPPU
## 1: 45.653
## 2: 28.510
## 3: 43.314
## 4: 19.468
## 5: 31.756
## 6: 41.930</code></pre>
</div>
<div id="level-5-n-1" class="section level3 unnumbered hasAnchor">
<h3>level 5 (N)<a href="data.table-pt3.html#level-5-n-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Возьмите пользователей, которые пришли в июне.
Оставьте только те платежи, которые были сделаны в период первых 30 дней от инсталла (pay_dt - install_dt &lt; 30). Метрика количества дней от инсталла называется лайфтайм (<code>lifetime</code>).</p>
<p>Создайте таблицу, в которой будет всего пользователей, установивших приложение, все из монетизационные метрика (из level 2) + доля платящих от общего числа пользователей (<code>conversion</code>) и средний платеж каждого пользователя когорты, независимо, платящий он или нет (<code>ARPU</code>).</p>
<p>У меня в результатах почищены данные по инсталлам.</p>
<pre><code>##         media_source total_users n_payers    gross conversion ARPU  ARPPU
## 1:      Facebook Ads        1297       53   884.43      0.041 0.68 16.687
## 2:      applovin_int       36714     1115 38133.02      0.030 1.04 34.200
## 3: googleadwords_int        7767      160  4302.90      0.021 0.55 26.893
## 4:           organic       43070     1000 38867.72      0.023 0.90 38.868
## 5:      unityads_int       21932      263  6099.07      0.012 0.28 23.190
##    n_purchases purchases_per_user purchase_mn
## 1:         101               1.91        8.76
## 2:        4529               4.06        8.42
## 3:         509               3.18        8.45
## 4:        4336               4.34        8.96
## 5:         969               3.68        6.29</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data.table-pt2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dt-etl.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

</body>

</html>
